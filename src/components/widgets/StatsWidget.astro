---
import { useState, useEffect } from 'react';
import WidgetWrapper from '../ui/WidgetWrapper.astro';
import Headline from '../ui/Headline.astro';
import { Icon } from 'astro-icon/components';
---

<div id="stats-widget">
  <WidgetWrapper id="dynamic-stats-widget" isDark={false} containerClass="max-w-6xl mx-auto" bg="">

    <!-- Headline for Stats -->
    <Headline title="Dynamic Stats" subtitle="Live updates for YouTube and Twitter" />

    <!-- Stats Layout -->
    <div class="flex flex-wrap justify-center -m-4 text-center">
      <!-- YouTube Stats -->
      <div class="p-4 md:w-1/4 sm:w-1/2 w-full min-w-[220px] text-center md:border-r md:last:border-none dark:md:border-slate-500">
        <div class="flex items-center justify-center mx-auto mb-4 text-primary">
          <Icon name="tabler:brand-youtube" class="w-10 h-10" />  <!-- YouTube Icon -->
        </div>
        <div class="font-heading text-primary text-[2.6rem] font-bold dark:text-white lg:text-5xl xl:text-6xl" id="youtube-subscribers">
          Loading...
        </div>
        <div class="text-sm font-medium uppercase tracking-widest text-gray-800 dark:text-slate-400 lg:text-base">YouTube Subscribers</div>
      </div>

      <div class="p-4 md:w-1/4 sm:w-1/2 w-full min-w-[220px] text-center md:border-r md:last:border-none dark:md:border-slate-500">
        <div class="flex items-center justify-center mx-auto mb-4 text-primary">
          <Icon name="tabler:video" class="w-10 h-10" />  <!-- Video Icon -->
        </div>
        <div class="font-heading text-primary text-[2.6rem] font-bold dark:text-white lg:text-5xl xl:text-6xl" id="youtube-videos">
          Loading...
        </div>
        <div class="text-sm font-medium uppercase tracking-widest text-gray-800 dark:text-slate-400 lg:text-base">YouTube Videos</div>
      </div>

      <div class="p-4 md:w-1/4 sm:w-1/2 w-full min-w-[220px] text-center md:border-r md:last:border-none dark:md:border-slate-500">
        <div class="flex items-center justify-center mx-auto mb-4 text-primary">
          <Icon name="tabler:eye" class="w-10 h-10" />  <!-- Eye Icon for Views -->
        </div>
        <div class="font-heading text-primary text-[2.6rem] font-bold dark:text-white lg:text-5xl xl:text-6xl" id="youtube-views">
          Loading...
        </div>
        <div class="text-sm font-medium uppercase tracking-widest text-gray-800 dark:text-slate-400 lg:text-base">YouTube Views</div>
      </div>

      <!-- Twitter Stats -->
      <div class="p-4 md:w-1/4 sm:w-1/2 w-full min-w-[220px] text-center">
        <div class="flex items-center justify-center mx-auto mb-4 text-primary">
          <Icon name="tabler:brand-twitter" class="w-10 h-10" />  <!-- Twitter Icon -->
        </div>
        <div class="font-heading text-primary text-[2.6rem] font-bold dark:text-white lg:text-5xl xl:text-6xl" id="twitter-followers">
          Loading...
        </div>
        <div class="text-sm font-medium uppercase tracking-widest text-gray-800 dark:text-slate-400 lg:text-base">Twitter Followers</div>
      </div>
    </div>
  </WidgetWrapper>

  <script>
    // Fetch YouTube Stats
    const fetchYouTubeStats = async () => {
      const apiKey = 'AIzaSyDGi1JBTHwYeIbT_eHTlzafzUDdmP5dKnE';
      const channelId = 'UCwdf1LO9-Wj8qVxxFJdeIUQ';  // YouTube Channel ID for Spectral Horizons
      const response = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${apiKey}`);
      const data = await response.json();
      return data.items[0].statistics;
    };

    // Fetch Twitter Stats
    const fetchTwitterFollowers = async () => {
      const bearerToken = 'YOUR_TWITTER_BEARER_TOKEN';  // Replace with your actual Twitter Bearer Token
      const response = await fetch('https://api.twitter.com/2/users/by/username/SpectralHorizon', {
        headers: {
          'Authorization': `Bearer ${bearerToken}`,
        },
      });
      const data = await response.json();
      return data.data.public_metrics.followers_count;
    };

    // Update Stats in DOM
    const updateStats = async () => {
      const youtubeStats = await fetchYouTubeStats();
      const twitterFollowers = await fetchTwitterFollowers();

      // Update YouTube stats
      document.getElementById('youtube-subscribers').textContent = youtubeStats.subscriberCount;
      document.getElementById('youtube-videos').textContent = youtubeStats.videoCount;
      document.getElementById('youtube-views').textContent = youtubeStats.viewCount;

      // Update Twitter followers
      document.getElementById('twitter-followers').textContent = twitterFollowers;
    };

    // Call the update function when the page loads
    window.onload = updateStats;
  </script>
</div>